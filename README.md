# Веб-API для интернет-магазина электроники

## Название и основное назначение веб-сервиса

**Electronics Store API** — это RESTful веб-сервис (API), предназначенный для управления товарами, категориями и заказами в интернет-магазине электроники. Сервис предоставляет программный интерфейс для выполнения операций с товарами и обработки заказов клиентов.

## Краткое описание решаемой задачи и целевой аудитории

### Решаемая задача

Веб-сервис решает следующие задачи:
- Управление каталогом товаров (добавление, получение информации о товарах)
- Фильтрация товаров по категориям
- Обработка заказов клиентов с проверкой наличия товара на складе
- Управление складскими остатками
- Получение информации о заказах и их статусах

### Целевая аудитория

**Разработчики:**
- Frontend-разработчики, создающие клиентские приложения для интернет-магазина
- Мобильные разработчики, интегрирующие API в мобильные приложения
- Разработчики других сервисов, которым требуется доступ к данным магазина

**Пользователи:**
- Администраторы магазина, управляющие каталогом товаров
- Клиенты, оформляющие заказы через клиентские приложения

## Перечень основных функций, выполняемых сервисом

### 1. Управление товарами

#### Получение списка товаров
- **Функция**: Получение полного списка всех товаров из каталога
- **Фильтрация**: Возможность фильтрации товаров по категории через query-параметр
- **Формат ответа**: JSON-массив объектов товаров

#### Получение информации о товаре
- **Функция**: Получение детальной информации о конкретном товаре по его ID
- **Валидация**: Проверка существования товара, возврат ошибки 404 при отсутствии

#### Добавление нового товара
- **Функция**: Добавление нового товара в каталог
- **Валидация**: Проверка обязательных полей (название, цена)
- **Автоматическое заполнение**: Установка значений по умолчанию для необязательных полей

### 2. Управление категориями

#### Получение списка категорий
- **Функция**: Получение уникального списка всех категорий товаров
- **Использование**: Для построения фильтров и навигации в клиентских приложениях

### 3. Управление заказами

#### Создание заказа
- **Функция**: Оформление нового заказа клиентом
- **Бизнес-логика**:
  - Проверка наличия всех указанных товаров
  - Проверка достаточности количества товара на складе
  - Автоматический расчет общей суммы заказа
  - Атомарное обновление остатков на складе (транзакция)
- **Валидация**: Проверка обязательных полей (имя клиента, email, список товаров)
- **Обработка ошибок**: Откат транзакции при недостаточном количестве товара или отсутствии товара

#### Получение списка заказов
- **Функция**: Получение списка всех заказов
- **Формат**: JSON-массив с информацией о заказах и их позициях

#### Получение информации о заказе
- **Функция**: Получение детальной информации о конкретном заказе
- **Данные**: Полная информация о заказе включая список товаров с их названиями

### 4. Служебные функции

#### Проверка работоспособности
- **Функция**: Health check endpoint для мониторинга состояния сервиса
- **Использование**: Проверка доступности API для систем мониторинга и балансировщиков нагрузки

#### Информация об API
- **Функция**: Получение базовой информации о сервисе и списка доступных эндпоинтов

## Архитектурные особенности

### Используемые технологии

#### Backend Framework
- **Node.js** — серверная платформа на основе JavaScript
- **Express.js** — минималистичный веб-фramework для Node.js
  - Обработка HTTP-запросов
  - Маршрутизация
  - Middleware для CORS и парсинга JSON

#### База данных
- **SQLite3** — встраиваемая реляционная база данных
  - Легковесная и не требует отдельного сервера
  - Подходит для разработки и небольших проектов
  - Поддержка транзакций для обеспечения целостности данных

#### Документация API
- **Swagger (OpenAPI 3.0)** — автоматическая генерация документации
  - **swagger-ui-express** — интерфейс для просмотра документации
  - **swagger-jsdoc** — генерация спецификации из JSDoc комментариев

#### Дополнительные библиотеки
- **cors** — middleware для обработки Cross-Origin Resource Sharing
- **body-parser** — middleware для парсинга тела HTTP-запросов

### Архитектура базы данных

#### Таблица `products`
Хранит информацию о товарах:
- `id` — уникальный идентификатор (PRIMARY KEY, AUTOINCREMENT)
- `name` — название товара (NOT NULL)
- `description` — описание товара
- `price` — цена товара (NOT NULL)
- `category` — категория товара
- `inStock` — количество товара на складе (DEFAULT 0)
- `createdAt` — дата создания записи (DEFAULT CURRENT_TIMESTAMP)

#### Таблица `orders`
Хранит информацию о заказах:
- `id` — уникальный идентификатор (PRIMARY KEY, AUTOINCREMENT)
- `clientName` — имя клиента (NOT NULL)
- `clientEmail` — email клиента (NOT NULL)
- `clientPhone` — телефон клиента
- `totalAmount` — общая сумма заказа (NOT NULL)
- `status` — статус заказа (DEFAULT 'pending')
- `createdAt` — дата создания заказа (DEFAULT CURRENT_TIMESTAMP)

#### Таблица `order_items`
Хранит позиции заказов (связь many-to-many между заказами и товарами):
- `id` — уникальный идентификатор (PRIMARY KEY, AUTOINCREMENT)
- `orderId` — ID заказа (FOREIGN KEY → orders.id)
- `productId` — ID товара (FOREIGN KEY → products.id)
- `quantity` — количество товара (NOT NULL)
- `price` — цена товара на момент заказа (NOT NULL)

### Особенности реализации

#### Транзакции
При создании заказа используется транзакция SQLite для обеспечения атомарности операций:
- Проверка наличия всех товаров
- Проверка достаточности количества
- Создание записи заказа
- Создание записей позиций заказа
- Обновление остатков на складе
- При любой ошибке выполняется ROLLBACK

#### Обработка ошибок
- Валидация входных данных на уровне API
- Проверка существования ресурсов перед операциями
- Информативные сообщения об ошибках в формате JSON
- Корректные HTTP статус-коды (200, 201, 400, 404, 500)

#### CORS
Включена поддержка Cross-Origin Resource Sharing для работы с клиентскими приложениями на других доменах.

## Инструкции по развертыванию и запуску веб-сервиса

### Требования

- **Node.js** версии 14.0 или выше
- **npm** (Node Package Manager) версии 6.0 или выше

### Локальное развертывание

#### 1. Установка зависимостей

Клонируйте репозиторий или скопируйте файлы проекта, затем выполните:

```bash
cd web-api
npm install
```

Эта команда установит все необходимые зависимости, указанные в `package.json`:
- express
- cors
- body-parser
- sqlite3
- swagger-ui-express
- swagger-jsdoc

#### 2. Запуск сервера

Для запуска в production режиме:

```bash
npm start
```

Для запуска в режиме разработки с автоматической перезагрузкой (требуется nodemon):

```bash
npm run dev
```

Сервер будет доступен по адресу: `http://localhost:3000`

#### 3. Проверка работоспособности

Откройте в браузере:
- `http://localhost:3000/health` — проверка работоспособности
- `http://localhost:3000/api-docs` — Swagger документация

### Развертывание в облаке (Render.com)

#### 1. Подготовка проекта

Убедитесь, что в `package.json` указан скрипт `start`:

```json
{
  "scripts": {
    "start": "node server.js"
  }
}
```

#### 2. Создание сервиса на Render

1. Зарегистрируйтесь на [render.com](https://render.com)
2. Создайте новый Web Service
3. Подключите репозиторий GitHub
4. Укажите следующие настройки:
   - **Build Command**: `npm install`
   - **Start Command**: `npm start`
   - **Environment**: Node
   - **Port**: 3000 (или используйте переменную окружения PORT)

#### 3. Переменные окружения

При необходимости можно настроить переменные окружения:
- `PORT` — порт для запуска сервера (по умолчанию 3000)

#### 4. Деплой

После настройки Render автоматически выполнит деплой. Сервис будет доступен по URL вида: `https://your-service.onrender.com`

### Использование Swagger документации

После запуска сервера документация API доступна по адресу:
- **Локально**: `http://localhost:3000/api-docs`
- **На сервере**: `https://your-service.onrender.com/api-docs`

В Swagger UI можно:
- Просмотреть все доступные эндпоинты
- Изучить структуру запросов и ответов
- Протестировать API прямо из браузера
- Просмотреть примеры запросов

### Первоначальная инициализация базы данных

База данных SQLite создается автоматически при первом запуске сервера. Таблицы создаются автоматически, и в таблицу `products` добавляются тестовые данные (5 товаров), если таблица пуста.

Файл базы данных `database.db` создается в корневой директории проекта.

### Примеры использования API

#### Получение всех товаров

```bash
curl http://localhost:3000/api/products
```

#### Получение товаров по категории

```bash
curl "http://localhost:3000/api/products?category=Смартфоны"
```

#### Создание заказа

```bash
curl -X POST http://localhost:3000/api/orders \
  -H "Content-Type: application/json" \
  -d '{
    "clientName": "Иван Иванов",
    "clientEmail": "ivan@example.com",
    "clientPhone": "+79001234567",
    "items": [
      {"productId": 1, "quantity": 2}
    ]
  }'
```

#### Добавление товара

```bash
curl -X POST http://localhost:3000/api/products \
  -H "Content-Type: application/json" \
  -d '{
    "name": "Новый товар",
    "description": "Описание товара",
    "price": 5000,
    "category": "Аксессуары",
    "inStock": 20
  }'
```

## Структура проекта

```
web-api/
├── server.js              # Основной файл сервера и API
├── package.json           # Конфигурация проекта и зависимости
├── package-lock.json     # Зафиксированные версии зависимостей
├── database.db           # База данных SQLite (создается автоматически)
├── README.md            # Документация (этот файл)
├── .gitignore           # Игнорируемые файлы для Git
└── node_modules/        # Установленные зависимости
```

## Дополнительная информация

### API Endpoints

Полный список эндпоинтов доступен в Swagger документации по адресу `/api-docs` или в корневом эндпоинте `/`.

### Обработка ошибок

Все ошибки возвращаются в формате JSON:

```json
{
  "error": "Описание ошибки"
}
```

### Статус-коды HTTP

- `200 OK` — успешный запрос
- `201 Created` — ресурс успешно создан
- `400 Bad Request` — неверные входные данные
- `404 Not Found` — ресурс не найден
- `500 Internal Server Error` — ошибка сервера

## Контакты и поддержка

Для вопросов и предложений обращайтесь к разработчикам проекта.
